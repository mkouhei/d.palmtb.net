自宅ネットワークの構成変更。
============================

GDDフォンだと、WPA2(AES)でステルスモードにしている無線LANルータで認証できず、通信できないことは先日書いたが、FONだと大丈夫だった。が、FONをそのまま自宅内ネットワークで使っても、インターネットにアクセスすることができない。FON自体がhigh portを必要とする通信を行っているからだ。かと言って、FONのためだけにファイアウォールの設定を緩くするのはナンセンスだし、ステルスモードを使えないのも嫌だ。で、方針を変えることにした。自宅内ネットワークでGDDフォンを使ってAndroidで遊ぶのではなく、FONを自宅内ネットワークの外に出して、自宅ネットワークとは論理的に分離することにした。



現状の自宅のネットワークは、マンションの光ケーブルでの共同LANになっており、サーバを置いている部屋 [#]_ のクローゼットの床下にゲートウェイからのケーブルと、自宅の各部屋へ分岐させるためのリピートHUBが設置されている。各部屋のRJ-45のポートに挿すとマンション側のDHCPサーバからグローバルIPアドレスが割り当てられるのだが、インターネット側からも直接アクセスできてしまうのはよろしくないので、インターネット側のケーブルとサーバルームのポートを直接つなぎ、ファイアウォールを噛ませ、そこから一度L2スイッチに差し、そこからさらに内部のファイアウォールを経由してまたスイッチを介してからクローゼット床下に戻し、各部屋は内部のファイアウォールの内側になるような構成にしている。大雑把に図にするとこんな感じ。


.. code-block:: sh


   入居時の構成
   Internet -- hub
               |-- リビング
               |-- 和室
               |-- 洋間
               `-- 洋間
   現在の構成
   Internet -- Firewall
               `--L2Switch
                  |-- server
                  (snip)
                  |-- server
                  `--Firewall
                     `-- L2Switch
                         |-- server
                         (snip)
                         |-- server
                         `-- HUB
                             |-- リビング
                             |-- 和室
                             |-- 洋間
                             `-- 洋間




で、FONは外側のファイアウォールの外側に出すことにした。自宅で使っているL2スイッチは2台だけなのだが、こやつらがポートVLANを使えるので、今回の構成変更による既存のネットワーク構成には影響がないのが良い。



今回の変更後の構成


.. code-block:: sh


   Internet -- L2Switch
               |-- FON
               |   `-- GDDフォン
               `-- Firewall
                   `--L2Switch
                      |-- server
                      (snip)
                      |-- server
                      `--Firewall
                         `-- L2Switch
                             |-- server
                             (snip)
                             |-- server
                             `-- HUB
                                 |-- リビング
                                 |-- 和室
                                 |-- 洋間
                                 `-- 洋間




これで、GDDフォン用の無線LAN環境ができた。それと、前回の社内勉強会の宴会で決まった、うちで勉強会の番外編(=飲み会)を開催しても、無線LANスポットを提供できるようになった。と言いたい所なのだが、なんか、うちのFONは初回の設定時に自宅内のネットワーク内に接続して、上記のhigh portを使う設定を先に行ってしまったためか、FONルータの登録ができなくなってしまい、いまだステータスがLinusではなくAlienのままだったりする。どうやったら再度FONルーターの位置情報ページが表示されるのだろうか。 `FAQの情報 <http://www.fon.ne.jp/faq/>`_ が役に立たないのが非常に面倒くさい。




.. [#] 通称、図書室兼サーバルーム。


.. author:: default
.. categories:: network,gadget
.. comments::
