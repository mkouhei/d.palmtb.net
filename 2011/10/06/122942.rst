PowerDNS GUIの困った話（その２）。
##############################################


pdns-guiのインストールは、PHP 5.3以上を使っている環境ではこけます [#]_ 。理由は、data/symfony/config/php.ymlファイルにある、zend.ze1_compatibility_modeというキーが、PHP 5.3以上ではphp.iniでサポートされなくなったためです [#]_ 。
この問題は、pdns-guiのissueに登録されていたのですが、上記のYAMLファイルから上記のキーの行を削除しただけではダメで、YAMLファイルのパース時以外にも、symfony.phpや、data/symfony/bin/symfony.phpで、

.. code-block:: none

   if (ini_get(&#39;zend.ze1_compatibility_mode&#39;))
   {
     die(symfony cannot run with zend.ze1_compatibility_mode enabled.\nPlease turn zend.ze1_compatibility_mode to Off in your php.ini.\n);
   }


として別にチェックされているので、

.. code-block:: none

   --- a/data/symfony/bin/symfony.php
   +++ b/data/symfony/bin/symfony.php
   @@ -13,10 +13,12 @@ if (!isset($sf_symfony_lib_dir))
      die(You must launch symfony command line with the symfony script\n);
    }
    
   -if (ini_get(&#39;zend.ze1_compatibility_mode&#39;))
   -{
   -  die(symfony cannot run with zend.ze1_compatibility_mode enabled.\nPlease turn zend.ze1_compatibility_mode to Off in your php.ini.\n);
   -}
   +if (! (PHP_VERSION_ID  50300)) {
   +  if (ini_get(&#39;zend.ze1_compatibility_mode&#39;))
   +    {
   +      die(symfony cannot run with zend.ze1_compatibility_mode enabled.\nPlease turn zend.ze1_compatibility_mode to Off in your php.ini.\n);
   +    }
   +} 
    
    // set magic_quotes_runtime to off
    ini_set(&#39;magic_quotes_runtime&#39;, &#39;Off&#39;);


のように、PHPのバージョンをチェックをさせるようにしました。YAMLは条件分岐を入れられない？と思うので、これは素直にINSTALLに注意書きを追記して、issueにパッチを登録しておきました。


.. rubric:: footnote

.. [#] ：むしろこっちが.. [#] その１.. [#] じゃないか、というツッコミは無しで。w
.. [#] ：検証で使っている環境はUbuntu 10.04 LTSで、PHP 5.3.2なので。



.. author:: mkouhei
.. categories:: Dev, 
.. tags::


